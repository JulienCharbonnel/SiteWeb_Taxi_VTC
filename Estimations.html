<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Estimations</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCuLTThGQi4X9QcApByoI2FTc9pxNb9EQ&libraries=places"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
</head>
<style>
input[type=text], select {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
}

input[type=submit] {
  width: 100%;
  background-color: #4CAF50;
  color: white;
  padding: 14px 20px;
  margin: 8px 0;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

input[type=submit]:hover {
  background-color: #45a049;
}

div {
  border-radius: 5px;
  background-color: #f2f2f2;
  padding: 20px;
}
</style>
<body>

<h3>Estimations du prix de la course</h3>

<div>
    <!--Formulaires villes, code postal, adresse de départ, adresse de destination-->
    <form method="post">
        <label for="villeDepart">Adresse de départ</label>
        <input type="text" id="villeDepart" name="villeDepart" placeholder="Ville de départ">

        <label for="adresseArrivee">Adresse d'arrivée</label>
        <input type="text" id="adresseArrivee" name="adresseArrivee" placeholder="Adresse d'arrivée">
    </form>
    <!--Bouton vert en w3css pour valider le formulaire-->
    <button class="w3-button w3-block w3-green w3-section w3-padding" name="estimer" onclick="calculerRouteKm()">Estimer</button>
</div>




<script type="text/javascript">


  function ini_Autocompletion(id) 
  {
  var element = document.getElementById(id);
  if (element) 
  {
    var autocompletion = new google.maps.places.Autocomplete(element, { types: ['geocode'] });
    google.maps.event.addListener(autocompletion, 'place_changed', ini_Adresse);
  }
  }

  function ini_Adresse() 
  {
    var place = this.getPlace();
    console.log(place);
    for (var i in place.address_components) 
    {
      var component = place.address_components[i];
      for (var j in component.types) 
    {
        var type_element = document.getElementById(component.types[j]);
        if (type_element) 
      {
          type_element.value = component.long_name;
        }
      }
    }
  }

  google.maps.event.addDomListener(window, 'load', function()
  {
    ini_Autocompletion('villeDepart');
    ini_Autocompletion('adresseArrivee');
  });

  function calculerRouteKm() {
      var directionsService = new google.maps.DirectionsService();
      var villeDepart = document.getElementById('villeDepart').value;
      var adresseArrivee = document.getElementById('adresseArrivee').value;
      var request = {
          origin: villeDepart,
          destination: adresseArrivee,
          travelMode: google.maps.DirectionsTravelMode.DRIVING
      };
      directionsService.route(request, function(response, status) {
        if (status == google.maps.DirectionsStatus.OK) {
            var distance = response.routes[0].legs[0].distance.value;
            var distanceKm = distance / 1000;
            var distanceKmArrondi = Math.round(distanceKm);
            var prix = distanceKmArrondi * 0.5;
            var prixArrondi = Math.round(prix);
            alert("La distance entre les deux adresses est de " + distanceKmArrondi + " km. Le prix de la course est de " + prixArrondi + " €.");
        }
      });
  }

  

  </script>  

</body>
</html>